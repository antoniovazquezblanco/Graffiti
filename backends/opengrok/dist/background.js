(()=>{"use strict";var e={630:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.onExtMessageEx=t.onExtMessage=t.sendExtMessage=t.setPrefs=t.getPrefs=void 0;const n={tabBehavior:"alwaysNew"};t.getPrefs=function(e){chrome.storage.local.get(Object.keys(n)).then((t=>e(Object.assign(Object.assign({},n),t))))},t.setPrefs=function(e){chrome.storage.local.set(e)},t.sendExtMessage=function(e){return chrome.runtime.sendMessage(e)},t.onExtMessage=function(e){chrome.runtime.onMessage.addListener(((t,n,o)=>(e(t),o({}),!0)))},t.onExtMessageEx=function(e){chrome.runtime.onMessage.addListener(((t,n,o)=>e(t,o)))}}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}(()=>{const e=n(630);let t,o;function s(e){chrome.windows.getAll({populate:!0},(function(t){const n=t.filter((e=>0==(e.tabs||[]).filter((e=>"Graffiti"==e.title)).length));if(n.length){const t=n.filter((e=>e.focused));t.length?chrome.tabs.create({url:e,windowId:t[0].id}):chrome.tabs.create({url:e,windowId:n[0].id})}else chrome.windows.create({url:e})}))}function i(e){if(console.log(e),!e.isCorrectWebsite)return;const n=e.info;if(null==n)return void chrome.notifications.create("noSymbol",{type:"basic",iconUrl:"images/icon.png",title:"Graffiti",message:"Could not find symbol in this line"});const o=t;if(null==o)return void chrome.notifications.create("notConnected",{type:"basic",iconUrl:"images/icon.png",title:"Graffiti",message:"Not connected to server"});const s={type:"addData",node:{project:"OpenGrok: "+n.site,address:n.address,label:n.fileName+"::\n"+n.sig,computedProperties:[]}};n.edgeLabel&&(s.edge={label:n.edgeLabel}),o.send(JSON.stringify(s))}function r(e){if(console.log(e),!e.isCorrectWebsite)return;const n=e.info;if(null==n)return void chrome.notifications.create("noLine",{type:"basic",iconUrl:"images/icon.png",title:"Graffiti",message:"Could not find a line"});const o=t;if(null==o)return void chrome.notifications.create("notConnected",{type:"basic",iconUrl:"images/icon.png",title:"Graffiti",message:"Not connected to server"});const s=n.sig?n.fileName+"::\n"+n.sig+":"+n.line:n.fileName+":"+n.line,i={type:"addData",node:{project:"OpenGrok: "+n.site,address:n.address,label:s,line:n.line,computedProperties:[]}};n.edgeLabel&&(i.edge={label:n.edgeLabel}),o.send(JSON.stringify(i))}function c(e,t,n){const o="add_line_to_graffiti"==e,s={action:"getSymbolRequest",source:n?"contextMenu":"command",isLine:o,askForEdgeText:"add_to_graffiti_with_custom_edge"==e};console.log(t),chrome.tabs.sendMessage(t.id,s,o?r:i)}chrome.runtime.onStartup.addListener((()=>{console.log("onStartup()")})),(0,e.getPrefs)((e=>{o=e})),chrome.storage.onChanged.addListener(((t,n)=>{(0,e.getPrefs)((e=>{o=e}))})),chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.create({id:"add_to_graffiti",title:"Add to Graph",contexts:["page"]}),chrome.contextMenus.create({id:"add_to_graffiti_with_custom_edge",title:"Add to Graph with edge comment",contexts:["page"]}),chrome.contextMenus.create({id:"add_line_to_graffiti",title:"Add current line to Graph",contexts:["page"]}),chrome.contextMenus.onClicked.addListener(((e,t)=>{t&&c(e.menuItemId,t,!0)}))})),(0,e.onExtMessage)((n=>{console.log("received:",n),"connectPull"==n.action?function(n){null!=t&&(t.readyState!==WebSocket.CLOSED&&t.close(),t=null);const i=new WebSocket(n);t=i,t.onopen=function(t){(0,e.sendExtMessage)({action:"getConnectionPullResult",status:!0})},t.onerror=function(n){(0,e.sendExtMessage)({action:"getConnectionPullResult",status:!1}),t==i&&(t=null)},t.onclose=function(n){(0,e.sendExtMessage)({action:"getConnectionPullResult",status:!1}),t==i&&(t=null)},t.onmessage=function(e){const t=JSON.parse(e.data);if("project"in t&&!t.project.startsWith("OpenGrok:"))return;const n=t.address,i=o.tabBehavior;"alwaysNew"==i?s(n):"sameIfExists"==i&&function(e){const t=new URL(e);t.hash="";const n=t.toString();chrome.tabs.query({},(function(t){const o=t.filter((e=>(e.url||"").indexOf(n)>=0&&e.windowId!=chrome.windows.WINDOW_ID_CURRENT));0==o.length?s(e):chrome.tabs.update(o[o.length-1].id,{url:e,active:!0})}))}(n)}}(n.addr):"getConnectionPullRequest"==n.action&&null!=t&&(0,e.sendExtMessage)({action:"getConnectionPullResult",status:t.readyState!==WebSocket.CLOSED})})),chrome.commands.onCommand.addListener((function(e){chrome.tabs.query({active:!0,lastFocusedWindow:!0},(function(t){t.forEach((t=>c(e,t,!1)))}))}))})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UixNQUFNN0UsRUFBTTRCLEVBQUtJLFFBRVhoRSxFQUFjOEIsRUFBWTlCLFlBQ2IsYUFBZkEsRUFDQStCLEVBQWFDLEdBQ1MsZ0JBQWZoQyxHQThCbkIsU0FBK0JnQyxHQUMzQixNQUFNOEUsRUFBd0IsSUFBSUMsSUFBSS9FLEdBQ3RDOEUsRUFBc0JFLEtBQU8sR0FDN0IsTUFBTUMsRUFBaUJILEVBQXNCSSxXQUU3Q2hILE9BQU9xQyxLQUFLNEUsTUFBTSxDQUFDLEdBQUcsU0FBVTVFLEdBQzVCLE1BQU02RSxFQUFlN0UsRUFBS0YsUUFDckJHLElBQVNBLEVBQUlSLEtBQU8sSUFBSXFGLFFBQVFKLElBQW1CLEdBQUt6RSxFQUFJTSxVQUFZNUMsT0FBTytCLFFBQVFxRixvQkFFakUsR0FBdkJGLEVBQWExRSxPQUNiWCxFQUFhQyxHQUViOUIsT0FBT3FDLEtBQUtnRixPQUFPSCxFQUFhQSxFQUFhMUUsT0FBUyxHQUFHSyxHQUFLLENBQzFEZixJQUFLQSxFQUNMd0YsUUFBUSxHQUdwQixHQUNKLENBL0NZQyxDQUFzQnpGLEVBRTlCLENBQ0osQ0E5RFkwRixDQUFxQjlHLEVBQU9tRixNQUNKLDRCQUFqQm5GLEVBQU9xRSxRQUNXLE1BQXJCcEQsSUFDQSxJQUFBMEUsZ0JBQWUsQ0FDWHRCLE9BQVEsMEJBQ1J1QixPQUFRM0UsRUFBa0JtRSxhQUFlQyxVQUFVQyxRQUcvRCxJQUlKaEcsT0FBT3lILFNBQVMvQyxVQUFVM0QsYUFBWSxTQUFVNEQsR0FDNUMzRSxPQUFPcUMsS0FBSzRFLE1BQU0sQ0FBRUssUUFBUSxFQUFNSSxtQkFBbUIsSUFBUSxTQUFVckYsR0FDbkVBLEVBQUtzRixTQUFTckYsR0FBUW9DLEVBQVVDLEVBQTRCckMsR0FBSyxJQUNyRSxHQUNKLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zb3VyY2VncmFwaC8uL3NyYy9zY3JpcHRzL3NoYXJlZC50cyIsIndlYnBhY2s6Ly9zb3VyY2VncmFwaC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9zb3VyY2VncmFwaC8uL3NyYy9zY3JpcHRzL2JhY2tncm91bmQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogUHJlZnMgKi9cblxuY29uc3QgUFJFRl9LRVlTID0gW1widGFiQmVoYXZpb3JcIl07XG5cbmV4cG9ydCB0eXBlIFRhYkJlaGF2aW9yID0gXCJhbHdheXNOZXdcIiB8IFwic2FtZUlmRXhpc3RzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJlZnMge1xuICAgIHRhYkJlaGF2aW9yOiBUYWJCZWhhdmlvcjtcbn1cblxuY29uc3QgUFJFRlNfREVGQVVMVFM6IFByZWZzID0ge1xuICAgIHRhYkJlaGF2aW9yOiBcImFsd2F5c05ld1wiLFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFByZWZzKG9uUHJlZnM6IChwcmVmczogUHJlZnMpID0+IHZvaWQpIHtcbiAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbFxuICAgICAgICAuZ2V0KE9iamVjdC5rZXlzKFBSRUZTX0RFRkFVTFRTKSlcbiAgICAgICAgLnRoZW4oKHJlc3VsdCkgPT4gb25QcmVmcyh7IC4uLlBSRUZTX0RFRkFVTFRTLCAuLi4ocmVzdWx0IGFzIFBhcnRpYWw8UHJlZnM+KSB9KSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRQcmVmcyhwcmVmczogUGFydGlhbDxQcmVmcz4pIHtcbiAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5zZXQocHJlZnMpO1xufVxuXG4vKiBJbm5lciBleHRlbnNpb24gbWVzc2FnaW5nICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgR2V0Q29ubmVjdFB1bGxSZXN1bHRNZXNzYWdlIHtcbiAgICBhY3Rpb246IFwiZ2V0Q29ubmVjdGlvblB1bGxSZXN1bHRcIjtcbiAgICBzdGF0dXM6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgR2V0Q29ubmVjdFB1bGxSZXF1ZXN0TWVzc2FnZSB7XG4gICAgYWN0aW9uOiBcImdldENvbm5lY3Rpb25QdWxsUmVxdWVzdFwiO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbm5lY3RQdWxsTWVzc2FnZSB7XG4gICAgYWN0aW9uOiBcImNvbm5lY3RQdWxsXCI7XG4gICAgYWRkcjogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdldFN5bWJvbFJlcXVlc3RNZXNzYWdlIHtcbiAgICBhY3Rpb246IFwiZ2V0U3ltYm9sUmVxdWVzdFwiO1xuICAgIHNvdXJjZTogXCJjb21tYW5kXCIgfCBcImNvbnRleHRNZW51XCI7XG4gICAgaXNMaW5lOiBib29sZWFuO1xuICAgIGFza0ZvckVkZ2VUZXh0OiBib29sZWFuO1xufVxuXG5leHBvcnQgdHlwZSBFeHRNZXNzYWdlID1cbiAgICB8IEdldENvbm5lY3RQdWxsUmVxdWVzdE1lc3NhZ2VcbiAgICB8IEdldENvbm5lY3RQdWxsUmVzdWx0TWVzc2FnZVxuICAgIHwgQ29ubmVjdFB1bGxNZXNzYWdlXG4gICAgfCBHZXRTeW1ib2xSZXF1ZXN0TWVzc2FnZTtcblxuZXhwb3J0IGZ1bmN0aW9uIHNlbmRFeHRNZXNzYWdlKGV4dE1zZzogRXh0TWVzc2FnZSk6IFByb21pc2U8RXh0TWVzc2FnZT4ge1xuICAgIHJldHVybiBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZShleHRNc2cpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb25FeHRNZXNzYWdlKGNhbGxiYWNrOiAobXNnOiBFeHRNZXNzYWdlKSA9PiB2b2lkKSB7XG4gICAgY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKChtc2csIHNlbmRlciwgc2VuZFJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKG1zZyBhcyBFeHRNZXNzYWdlKTtcblxuICAgICAgICBzZW5kUmVzcG9uc2Uoe30pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9uRXh0TWVzc2FnZUV4KGNhbGxiYWNrOiAobXNnOiBFeHRNZXNzYWdlLCBzZW5kUmVzcG9uc2U6IChyZXNwb25zZTogYW55KSA9PiB2b2lkKSA9PiB2b2lkKSB7XG4gICAgY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKChtc2csIHNlbmRlciwgc2VuZFJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhtc2cgYXMgRXh0TWVzc2FnZSwgc2VuZFJlc3BvbnNlKTtcbiAgICB9KTtcbn1cblxuLyogU3ltYm9sIHJlbGF0ZWQgdHlwZXMgKi9cbmV4cG9ydCBpbnRlcmZhY2UgU3ltYm9sUHJvdmlkZXIge1xuICAgIGlzU3VwcG9ydGVkKCk6IGJvb2xlYW47XG4gICAgZ2V0Q3VycmVudFN5bWJvbCh4OiBudW1iZXIsIHk6IG51bWJlcik6IFN5bWJvbEluZm8gfCBudWxsO1xuICAgIGdldEN1cnJlbnRMaW5lU3ltYm9sKHg6IG51bWJlciwgeTogbnVtYmVyKTogU3ltYm9sSW5mbyB8IG51bGw7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3ltYm9sSW5mbyB7XG4gICAgc2l0ZTogc3RyaW5nO1xuICAgIGFkZHJlc3M6IHN0cmluZztcbiAgICBmaWxlTmFtZTogc3RyaW5nO1xuICAgIHNpZzogc3RyaW5nIHwgbnVsbDtcbiAgICBlZGdlTGFiZWw/OiBzdHJpbmc7XG4gICAgbGluZT86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTeW1ib2xSZXNwb25zZSB7XG4gICAgaXNDb3JyZWN0V2Vic2l0ZTogYm9vbGVhbjtcbiAgICBpbmZvOiBTeW1ib2xJbmZvIHwgbnVsbDtcbn1cbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCJpbXBvcnQgeyBHZXRTeW1ib2xSZXF1ZXN0TWVzc2FnZSwgUHJlZnMsIFN5bWJvbFJlc3BvbnNlLCBnZXRQcmVmcywgb25FeHRNZXNzYWdlLCBzZW5kRXh0TWVzc2FnZSB9IGZyb20gXCIuL3NoYXJlZFwiO1xuXG5sZXQgZ3JhZmZpdGlXZWJTb2NrZXQ6IFdlYlNvY2tldCB8IG51bGw7XG5sZXQgY2FjaGVkUHJlZnM6IFByZWZzO1xuXG50eXBlIEdyYWZmaXRpQ29tbWFuZCA9IFwiYWRkX3RvX2dyYWZmaXRpXCIgfCBcImFkZF90b19ncmFmZml0aV93aXRoX2N1c3RvbV9lZGdlXCIgfCBcImFkZF9saW5lX3RvX2dyYWZmaXRpXCI7XG5cbmZ1bmN0aW9uIHVwZGF0ZVByZWZzKCkge1xuICAgIGdldFByZWZzKChwcmVmcykgPT4ge1xuICAgICAgICBjYWNoZWRQcmVmcyA9IHByZWZzO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBtYWluKCkge1xuICAgIGNocm9tZS5ydW50aW1lLm9uU3RhcnR1cC5hZGRMaXN0ZW5lcigoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBvblN0YXJ0dXAoKWApO1xuICAgIH0pO1xuXG4gICAgLy8gQ2FjaGUgcHJlZnNcbiAgICBnZXRQcmVmcygocHJlZnMpID0+IHtcbiAgICAgICAgY2FjaGVkUHJlZnMgPSBwcmVmcztcbiAgICB9KTtcbiAgICBjaHJvbWUuc3RvcmFnZS5vbkNoYW5nZWQuYWRkTGlzdGVuZXIoKF8xLCBfMikgPT4gdXBkYXRlUHJlZnMoKSk7XG5cbiAgICAvLyBBZGQgY29udGV4dCBtZW51XG4gICAgY2hyb21lLnJ1bnRpbWUub25JbnN0YWxsZWQuYWRkTGlzdGVuZXIoKCkgPT4ge1xuICAgICAgICBjaHJvbWUuY29udGV4dE1lbnVzLmNyZWF0ZSh7XG4gICAgICAgICAgICBpZDogXCJhZGRfdG9fZ3JhZmZpdGlcIixcbiAgICAgICAgICAgIHRpdGxlOiBcIkFkZCB0byBHcmFwaFwiLFxuICAgICAgICAgICAgY29udGV4dHM6IFtcInBhZ2VcIl0sXG4gICAgICAgIH0pO1xuICAgICAgICBjaHJvbWUuY29udGV4dE1lbnVzLmNyZWF0ZSh7XG4gICAgICAgICAgICBpZDogXCJhZGRfdG9fZ3JhZmZpdGlfd2l0aF9jdXN0b21fZWRnZVwiLFxuICAgICAgICAgICAgdGl0bGU6IFwiQWRkIHRvIEdyYXBoIHdpdGggZWRnZSBjb21tZW50XCIsXG4gICAgICAgICAgICBjb250ZXh0czogW1wicGFnZVwiXSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY2hyb21lLmNvbnRleHRNZW51cy5jcmVhdGUoe1xuICAgICAgICAgICAgaWQ6IFwiYWRkX2xpbmVfdG9fZ3JhZmZpdGlcIixcbiAgICAgICAgICAgIHRpdGxlOiBcIkFkZCBjdXJyZW50IGxpbmUgdG8gR3JhcGhcIixcbiAgICAgICAgICAgIGNvbnRleHRzOiBbXCJwYWdlXCJdLFxuICAgICAgICB9KTtcblxuICAgICAgICBjaHJvbWUuY29udGV4dE1lbnVzLm9uQ2xpY2tlZC5hZGRMaXN0ZW5lcigoaW5mbywgdGFiKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRhYikgcmV0dXJuO1xuICAgICAgICAgICAgb25Db21tYW5kKGluZm8ubWVudUl0ZW1JZCBhcyBHcmFmZml0aUNvbW1hbmQsIHRhYiwgdHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gSGFuZGxlIGNvbm5lY3Rpb24gY29tbWFuZHNcbiAgICBvbkV4dE1lc3NhZ2UoKGV4dE1zZykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlY2VpdmVkOlwiLCBleHRNc2cpO1xuICAgICAgICBpZiAoZXh0TXNnLmFjdGlvbiA9PSBcImNvbm5lY3RQdWxsXCIpIHtcbiAgICAgICAgICAgIGNvbm5lY3RQdWxsV2ViU29ja2V0KGV4dE1zZy5hZGRyKTtcbiAgICAgICAgfSBlbHNlIGlmIChleHRNc2cuYWN0aW9uID09IFwiZ2V0Q29ubmVjdGlvblB1bGxSZXF1ZXN0XCIpIHtcbiAgICAgICAgICAgIGlmIChncmFmZml0aVdlYlNvY2tldCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgc2VuZEV4dE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IFwiZ2V0Q29ubmVjdGlvblB1bGxSZXN1bHRcIixcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBncmFmZml0aVdlYlNvY2tldC5yZWFkeVN0YXRlICE9PSBXZWJTb2NrZXQuQ0xPU0VELFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBIYW5kbGUga2V5Ym9hcmQgc2hvcnRjdXRzXG4gICAgY2hyb21lLmNvbW1hbmRzLm9uQ29tbWFuZC5hZGRMaXN0ZW5lcihmdW5jdGlvbiAoY29tbWFuZCkge1xuICAgICAgICBjaHJvbWUudGFicy5xdWVyeSh7IGFjdGl2ZTogdHJ1ZSwgbGFzdEZvY3VzZWRXaW5kb3c6IHRydWUgfSwgZnVuY3Rpb24gKHRhYnMpIHtcbiAgICAgICAgICAgIHRhYnMuZm9yRWFjaCgodGFiKSA9PiBvbkNvbW1hbmQoY29tbWFuZCBhcyBHcmFmZml0aUNvbW1hbmQsIHRhYiwgZmFsc2UpKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGNvbm5lY3RQdWxsV2ViU29ja2V0KGFkZHI6IHN0cmluZykge1xuICAgIGlmIChncmFmZml0aVdlYlNvY2tldCAhPSBudWxsKSB7XG4gICAgICAgIGlmIChncmFmZml0aVdlYlNvY2tldC5yZWFkeVN0YXRlICE9PSBXZWJTb2NrZXQuQ0xPU0VEKSBncmFmZml0aVdlYlNvY2tldC5jbG9zZSgpO1xuICAgICAgICBncmFmZml0aVdlYlNvY2tldCA9IG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHRtcFNvY2tldCA9IG5ldyBXZWJTb2NrZXQoYWRkcik7XG4gICAgZ3JhZmZpdGlXZWJTb2NrZXQgPSB0bXBTb2NrZXQ7XG5cbiAgICBncmFmZml0aVdlYlNvY2tldC5vbm9wZW4gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgc2VuZEV4dE1lc3NhZ2UoeyBhY3Rpb246IFwiZ2V0Q29ubmVjdGlvblB1bGxSZXN1bHRcIiwgc3RhdHVzOiB0cnVlIH0pO1xuICAgIH07XG5cbiAgICBncmFmZml0aVdlYlNvY2tldC5vbmVycm9yID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHNlbmRFeHRNZXNzYWdlKHsgYWN0aW9uOiBcImdldENvbm5lY3Rpb25QdWxsUmVzdWx0XCIsIHN0YXR1czogZmFsc2UgfSk7XG5cbiAgICAgICAgaWYgKGdyYWZmaXRpV2ViU29ja2V0ID09IHRtcFNvY2tldCkge1xuICAgICAgICAgICAgZ3JhZmZpdGlXZWJTb2NrZXQgPSBudWxsO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGdyYWZmaXRpV2ViU29ja2V0Lm9uY2xvc2UgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgc2VuZEV4dE1lc3NhZ2UoeyBhY3Rpb246IFwiZ2V0Q29ubmVjdGlvblB1bGxSZXN1bHRcIiwgc3RhdHVzOiBmYWxzZSB9KTtcblxuICAgICAgICBpZiAoZ3JhZmZpdGlXZWJTb2NrZXQgPT0gdG1wU29ja2V0KSB7XG4gICAgICAgICAgICBncmFmZml0aVdlYlNvY2tldCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGdyYWZmaXRpV2ViU29ja2V0Lm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcbiAgICAgICAgaWYgKFwicHJvamVjdFwiIGluIGRhdGEpIHtcbiAgICAgICAgICAgIGlmICghZGF0YVtcInByb2plY3RcIl0uc3RhcnRzV2l0aChcIk9wZW5Hcm9rOlwiKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cmwgPSBkYXRhLmFkZHJlc3M7XG5cbiAgICAgICAgY29uc3QgdGFiQmVoYXZpb3IgPSBjYWNoZWRQcmVmcy50YWJCZWhhdmlvcjtcbiAgICAgICAgaWYgKHRhYkJlaGF2aW9yID09IFwiYWx3YXlzTmV3XCIpIHtcbiAgICAgICAgICAgIGNyZWF0ZU5ld1RhYih1cmwpO1xuICAgICAgICB9IGVsc2UgaWYgKHRhYkJlaGF2aW9yID09IFwic2FtZUlmRXhpc3RzXCIpIHtcbiAgICAgICAgICAgIGNoYW5nZVNhbWVUYWJJZkV4aXN0cyh1cmwpO1xuICAgICAgICB9XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlTmV3VGFiKHVybDogc3RyaW5nKSB7XG4gICAgY2hyb21lLndpbmRvd3MuZ2V0QWxsKHsgcG9wdWxhdGU6IHRydWUgfSwgZnVuY3Rpb24gKHdpbmRvd3MpIHtcbiAgICAgICAgY29uc3Qgb3RoZXJXaW5kb3dzID0gd2luZG93cy5maWx0ZXIoXG4gICAgICAgICAgICAod2luZG93KSA9PiAod2luZG93LnRhYnMgfHwgW10pLmZpbHRlcigodGFiKSA9PiB0YWIudGl0bGUgPT0gXCJHcmFmZml0aVwiKS5sZW5ndGggPT0gMCxcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKG90aGVyV2luZG93cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vIHRyeSBmb2N1c2VkIG9uZVxuICAgICAgICAgICAgY29uc3Qgb3RoZXJXaW5kb3dzRm9jdXNlZCA9IG90aGVyV2luZG93cy5maWx0ZXIoKHdpbmRvdykgPT4gd2luZG93LmZvY3VzZWQpO1xuICAgICAgICAgICAgaWYgKG90aGVyV2luZG93c0ZvY3VzZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY2hyb21lLnRhYnMuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvd0lkOiBvdGhlcldpbmRvd3NGb2N1c2VkWzBdLmlkLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBUYWtlIHRoZSBmaXJzdFxuICAgICAgICAgICAgICAgIGNocm9tZS50YWJzLmNyZWF0ZSh7IHVybDogdXJsLCB3aW5kb3dJZDogb3RoZXJXaW5kb3dzWzBdLmlkIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyB3aW5kb3dcbiAgICAgICAgICAgIGNocm9tZS53aW5kb3dzLmNyZWF0ZSh7IHVybDogdXJsIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGNoYW5nZVNhbWVUYWJJZkV4aXN0cyh1cmw6IHN0cmluZykge1xuICAgIGNvbnN0IHVybFdpdGhvdXRIYXNoQnVpbGRlciA9IG5ldyBVUkwodXJsKTtcbiAgICB1cmxXaXRob3V0SGFzaEJ1aWxkZXIuaGFzaCA9IFwiXCI7XG4gICAgY29uc3QgdXJsV2l0aG91dEhhc2ggPSB1cmxXaXRob3V0SGFzaEJ1aWxkZXIudG9TdHJpbmcoKTtcblxuICAgIGNocm9tZS50YWJzLnF1ZXJ5KHt9LCBmdW5jdGlvbiAodGFicykge1xuICAgICAgICBjb25zdCBtYXRjaGluZ1RhYnMgPSB0YWJzLmZpbHRlcihcbiAgICAgICAgICAgICh0YWIpID0+ICh0YWIudXJsIHx8IFwiXCIpLmluZGV4T2YodXJsV2l0aG91dEhhc2gpID49IDAgJiYgdGFiLndpbmRvd0lkICE9IGNocm9tZS53aW5kb3dzLldJTkRPV19JRF9DVVJSRU5ULFxuICAgICAgICApO1xuICAgICAgICBpZiAobWF0Y2hpbmdUYWJzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICBjcmVhdGVOZXdUYWIodXJsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNocm9tZS50YWJzLnVwZGF0ZShtYXRjaGluZ1RhYnNbbWF0Y2hpbmdUYWJzLmxlbmd0aCAtIDFdLmlkISwge1xuICAgICAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgICAgIGFjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIG9uU3ltYm9sKHN5bWJvbFJlc3BvbnNlOiBTeW1ib2xSZXNwb25zZSkge1xuICAgIGNvbnNvbGUubG9nKHN5bWJvbFJlc3BvbnNlKTtcblxuICAgIGlmICghc3ltYm9sUmVzcG9uc2UuaXNDb3JyZWN0V2Vic2l0ZSkgcmV0dXJuO1xuXG4gICAgY29uc3Qgc3ltYm9sSW5mbyA9IHN5bWJvbFJlc3BvbnNlLmluZm87XG4gICAgaWYgKHN5bWJvbEluZm8gPT0gbnVsbCkge1xuICAgICAgICBjaHJvbWUubm90aWZpY2F0aW9ucy5jcmVhdGUoXCJub1N5bWJvbFwiLCB7XG4gICAgICAgICAgICB0eXBlOiBcImJhc2ljXCIsXG4gICAgICAgICAgICBpY29uVXJsOiBcImltYWdlcy9pY29uLnBuZ1wiLFxuICAgICAgICAgICAgdGl0bGU6IFwiR3JhZmZpdGlcIixcbiAgICAgICAgICAgIG1lc3NhZ2U6IFwiQ291bGQgbm90IGZpbmQgc3ltYm9sIGluIHRoaXMgbGluZVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHdlYnNvY2tldCA9IGdyYWZmaXRpV2ViU29ja2V0O1xuICAgIGlmICh3ZWJzb2NrZXQgPT0gbnVsbCkge1xuICAgICAgICBjaHJvbWUubm90aWZpY2F0aW9ucy5jcmVhdGUoXCJub3RDb25uZWN0ZWRcIiwge1xuICAgICAgICAgICAgdHlwZTogXCJiYXNpY1wiLFxuICAgICAgICAgICAgaWNvblVybDogXCJpbWFnZXMvaWNvbi5wbmdcIixcbiAgICAgICAgICAgIHRpdGxlOiBcIkdyYWZmaXRpXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBcIk5vdCBjb25uZWN0ZWQgdG8gc2VydmVyXCIsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgZGF0YTogYW55ID0ge1xuICAgICAgICB0eXBlOiBcImFkZERhdGFcIixcbiAgICAgICAgbm9kZToge1xuICAgICAgICAgICAgcHJvamVjdDogXCJPcGVuR3JvazogXCIgKyBzeW1ib2xJbmZvLnNpdGUsXG4gICAgICAgICAgICBhZGRyZXNzOiBzeW1ib2xJbmZvLmFkZHJlc3MsXG4gICAgICAgICAgICBsYWJlbDogc3ltYm9sSW5mby5maWxlTmFtZSArIFwiOjpcXG5cIiArIHN5bWJvbEluZm8uc2lnLFxuICAgICAgICAgICAgY29tcHV0ZWRQcm9wZXJ0aWVzOiBbXSxcbiAgICAgICAgfSxcbiAgICB9O1xuICAgIGlmIChzeW1ib2xJbmZvLmVkZ2VMYWJlbCkge1xuICAgICAgICBkYXRhLmVkZ2UgPSB7IGxhYmVsOiBzeW1ib2xJbmZvLmVkZ2VMYWJlbCB9O1xuICAgIH1cbiAgICB3ZWJzb2NrZXQuc2VuZChKU09OLnN0cmluZ2lmeShkYXRhKSk7XG59XG5cbmZ1bmN0aW9uIG9uTGluZVN5bWJvbChzeW1ib2xSZXNwb25zZTogU3ltYm9sUmVzcG9uc2UpIHtcbiAgICBjb25zb2xlLmxvZyhzeW1ib2xSZXNwb25zZSk7XG5cbiAgICBpZiAoIXN5bWJvbFJlc3BvbnNlLmlzQ29ycmVjdFdlYnNpdGUpIHJldHVybjtcblxuICAgIGNvbnN0IHN5bWJvbEluZm8gPSBzeW1ib2xSZXNwb25zZS5pbmZvO1xuXG4gICAgaWYgKHN5bWJvbEluZm8gPT0gbnVsbCkge1xuICAgICAgICBjaHJvbWUubm90aWZpY2F0aW9ucy5jcmVhdGUoXCJub0xpbmVcIiwge1xuICAgICAgICAgICAgdHlwZTogXCJiYXNpY1wiLFxuICAgICAgICAgICAgaWNvblVybDogXCJpbWFnZXMvaWNvbi5wbmdcIixcbiAgICAgICAgICAgIHRpdGxlOiBcIkdyYWZmaXRpXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBcIkNvdWxkIG5vdCBmaW5kIGEgbGluZVwiLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHdlYnNvY2tldCA9IGdyYWZmaXRpV2ViU29ja2V0O1xuICAgIGlmICh3ZWJzb2NrZXQgPT0gbnVsbCkge1xuICAgICAgICBjaHJvbWUubm90aWZpY2F0aW9ucy5jcmVhdGUoXCJub3RDb25uZWN0ZWRcIiwge1xuICAgICAgICAgICAgdHlwZTogXCJiYXNpY1wiLFxuICAgICAgICAgICAgaWNvblVybDogXCJpbWFnZXMvaWNvbi5wbmdcIixcbiAgICAgICAgICAgIHRpdGxlOiBcIkdyYWZmaXRpXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBcIk5vdCBjb25uZWN0ZWQgdG8gc2VydmVyXCIsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgbGFiZWwgPSBzeW1ib2xJbmZvLnNpZ1xuICAgICAgICA/IHN5bWJvbEluZm8uZmlsZU5hbWUgKyBcIjo6XFxuXCIgKyBzeW1ib2xJbmZvLnNpZyArIFwiOlwiICsgc3ltYm9sSW5mby5saW5lXG4gICAgICAgIDogc3ltYm9sSW5mby5maWxlTmFtZSArIFwiOlwiICsgc3ltYm9sSW5mby5saW5lO1xuXG4gICAgY29uc3QgZGF0YTogYW55ID0ge1xuICAgICAgICB0eXBlOiBcImFkZERhdGFcIixcbiAgICAgICAgbm9kZToge1xuICAgICAgICAgICAgcHJvamVjdDogXCJPcGVuR3JvazogXCIgKyBzeW1ib2xJbmZvLnNpdGUsXG4gICAgICAgICAgICBhZGRyZXNzOiBzeW1ib2xJbmZvLmFkZHJlc3MsXG4gICAgICAgICAgICBsYWJlbDogbGFiZWwsXG4gICAgICAgICAgICBsaW5lOiBzeW1ib2xJbmZvLmxpbmUsXG4gICAgICAgICAgICBjb21wdXRlZFByb3BlcnRpZXM6IFtdLFxuICAgICAgICB9LFxuICAgIH07XG4gICAgaWYgKHN5bWJvbEluZm8uZWRnZUxhYmVsKSB7XG4gICAgICAgIGRhdGEuZWRnZSA9IHsgbGFiZWw6IHN5bWJvbEluZm8uZWRnZUxhYmVsIH07XG4gICAgfVxuICAgIHdlYnNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbn1cblxuZnVuY3Rpb24gb25Db21tYW5kKGNvbW1hbmQ6IEdyYWZmaXRpQ29tbWFuZCwgdGFiOiBjaHJvbWUudGFicy5UYWIsIGlzQ29udGV4dE1lbnU6IGJvb2xlYW4pIHtcbiAgICBjb25zdCBpc0xpbmUgPSBjb21tYW5kID09IFwiYWRkX2xpbmVfdG9fZ3JhZmZpdGlcIjtcbiAgICBjb25zdCByZXF1ZXN0OiBHZXRTeW1ib2xSZXF1ZXN0TWVzc2FnZSA9IHtcbiAgICAgICAgYWN0aW9uOiBcImdldFN5bWJvbFJlcXVlc3RcIixcbiAgICAgICAgc291cmNlOiBpc0NvbnRleHRNZW51ID8gXCJjb250ZXh0TWVudVwiIDogXCJjb21tYW5kXCIsXG4gICAgICAgIGlzTGluZSxcbiAgICAgICAgYXNrRm9yRWRnZVRleHQ6IGNvbW1hbmQgPT0gXCJhZGRfdG9fZ3JhZmZpdGlfd2l0aF9jdXN0b21fZWRnZVwiLFxuICAgIH07XG4gICAgY29uc29sZS5sb2codGFiKTtcbiAgICBjaHJvbWUudGFicy5zZW5kTWVzc2FnZSh0YWIuaWQhLCByZXF1ZXN0LCBpc0xpbmUgPyBvbkxpbmVTeW1ib2wgOiBvblN5bWJvbCk7XG59XG5cbm1haW4oKTtcbiJdLCJuYW1lcyI6WyJQUkVGU19ERUZBVUxUUyIsInRhYkJlaGF2aW9yIiwib25QcmVmcyIsImNocm9tZSIsInN0b3JhZ2UiLCJsb2NhbCIsImdldCIsIk9iamVjdCIsImtleXMiLCJ0aGVuIiwicmVzdWx0IiwicHJlZnMiLCJzZXQiLCJleHRNc2ciLCJydW50aW1lIiwic2VuZE1lc3NhZ2UiLCJjYWxsYmFjayIsIm9uTWVzc2FnZSIsImFkZExpc3RlbmVyIiwibXNnIiwic2VuZGVyIiwic2VuZFJlc3BvbnNlIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJncmFmZml0aVdlYlNvY2tldCIsImNhY2hlZFByZWZzIiwiY3JlYXRlTmV3VGFiIiwidXJsIiwid2luZG93cyIsImdldEFsbCIsInBvcHVsYXRlIiwib3RoZXJXaW5kb3dzIiwiZmlsdGVyIiwid2luZG93IiwidGFicyIsInRhYiIsInRpdGxlIiwibGVuZ3RoIiwib3RoZXJXaW5kb3dzRm9jdXNlZCIsImZvY3VzZWQiLCJjcmVhdGUiLCJ3aW5kb3dJZCIsImlkIiwib25TeW1ib2wiLCJzeW1ib2xSZXNwb25zZSIsImNvbnNvbGUiLCJsb2ciLCJpc0NvcnJlY3RXZWJzaXRlIiwic3ltYm9sSW5mbyIsImluZm8iLCJub3RpZmljYXRpb25zIiwidHlwZSIsImljb25VcmwiLCJtZXNzYWdlIiwid2Vic29ja2V0IiwiZGF0YSIsIm5vZGUiLCJwcm9qZWN0Iiwic2l0ZSIsImFkZHJlc3MiLCJsYWJlbCIsImZpbGVOYW1lIiwic2lnIiwiY29tcHV0ZWRQcm9wZXJ0aWVzIiwiZWRnZUxhYmVsIiwiZWRnZSIsInNlbmQiLCJKU09OIiwic3RyaW5naWZ5Iiwib25MaW5lU3ltYm9sIiwibGluZSIsIm9uQ29tbWFuZCIsImNvbW1hbmQiLCJpc0NvbnRleHRNZW51IiwiaXNMaW5lIiwicmVxdWVzdCIsImFjdGlvbiIsInNvdXJjZSIsImFza0ZvckVkZ2VUZXh0Iiwib25TdGFydHVwIiwiZ2V0UHJlZnMiLCJvbkNoYW5nZWQiLCJfMSIsIl8yIiwib25JbnN0YWxsZWQiLCJjb250ZXh0TWVudXMiLCJjb250ZXh0cyIsIm9uQ2xpY2tlZCIsIm1lbnVJdGVtSWQiLCJvbkV4dE1lc3NhZ2UiLCJhZGRyIiwicmVhZHlTdGF0ZSIsIldlYlNvY2tldCIsIkNMT1NFRCIsImNsb3NlIiwidG1wU29ja2V0Iiwib25vcGVuIiwiZXZlbnQiLCJzZW5kRXh0TWVzc2FnZSIsInN0YXR1cyIsIm9uZXJyb3IiLCJvbmNsb3NlIiwib25tZXNzYWdlIiwicGFyc2UiLCJzdGFydHNXaXRoIiwidXJsV2l0aG91dEhhc2hCdWlsZGVyIiwiVVJMIiwiaGFzaCIsInVybFdpdGhvdXRIYXNoIiwidG9TdHJpbmciLCJxdWVyeSIsIm1hdGNoaW5nVGFicyIsImluZGV4T2YiLCJXSU5ET1dfSURfQ1VSUkVOVCIsInVwZGF0ZSIsImFjdGl2ZSIsImNoYW5nZVNhbWVUYWJJZkV4aXN0cyIsImNvbm5lY3RQdWxsV2ViU29ja2V0IiwiY29tbWFuZHMiLCJsYXN0Rm9jdXNlZFdpbmRvdyIsImZvckVhY2giXSwic291cmNlUm9vdCI6IiJ9